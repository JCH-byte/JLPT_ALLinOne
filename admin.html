<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>JLPT Data Manager</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
<div class="container">
    <h1>🛠️ JLPT 데이터 관리자 (Versioned)</h1>
    <p>localStorage 저장 구조는 <code>JLPT_DEV_DATA_OVERRIDE/{level}/{day}/{version}</code> 형태입니다.</p>

    <div class="control-panel">
        <label><strong>1. 작업할 레벨 선택:</strong></label>
        <select id="level-select">
            <option value="n5">N5 (기초 - 노랑)</option>
            <option value="n4">N4 (초급 - 초록)</option>
            <option value="n3">N3 (중급 - 파랑)</option>
            <option value="n2">N2 (중고급 - 주황)</option>
            <option value="n1">N1 (고급 - 빨강)</option>
        </select>

        <label style="margin-left:12px;"><strong>Day:</strong></label>
        <input id="day-input" type="number" min="1" value="1">
    </div>

    <div class="control-panel">
        <label><strong>작성자:</strong></label>
        <input id="author-input" type="text" placeholder="예: kim.dev">

        <label style="margin-left:12px;"><strong>변경 요약:</strong></label>
        <input id="summary-input" type="text" placeholder="예: Day 3 quiz 오타 수정">
    </div>

    <div class="control-panel">
        <label><strong>필수 필드 검증:</strong></label>
        <select id="required-field-mode">
            <option value="strict" selected>누락 시 저장 차단</option>
            <option value="warn">누락 시 강한 경고 후 진행</option>
        </select>

        <label style="margin-left:12px;"><strong>배열 병합 정책:</strong></label>
        <span class="array-policy-group">
            analysis
            <select id="policy-analysis">
                <option value="replace" selected>replace</option>
                <option value="upsert">upsert</option>
            </select>
        </span>
        <span class="array-policy-group">
            vocab
            <select id="policy-vocab">
                <option value="replace" selected>replace</option>
                <option value="upsert">upsert</option>
            </select>
        </span>
        <span class="array-policy-group">
            quiz
            <select id="policy-quiz">
                <option value="replace" selected>replace</option>
                <option value="upsert">upsert</option>
            </select>
        </span>
    </div>

    <h3>2. AI JSON 데이터 입력</h3>
    <textarea id="json-input" placeholder='{
  "day": 9,
  "data": {
    "title": "...",
    "vocab": []
  }
}'></textarea>

    <div style="margin-top:20px;">
        <button class="btn btn-preview" onclick="savePreview(false)">💾 draft 저장(덮어쓰기)</button>
        <button class="btn btn-merge" onclick="savePreview(true)">🔗 draft 저장(병합)</button>
        <button class="btn btn-download" onclick="downloadFile()">📥 표준 JSON 다운로드</button>
        <button class="btn" onclick="downloadLegacyJsFile()">🧩 레거시 JS 내보내기</button>
    </div>

    <h3 style="margin-top:30px;">3. 버전 히스토리</h3>
    <ul id="history-list" class="history-list"></ul>

    <div class="history-actions">
        <select id="history-select"></select>
        <button class="btn btn-approve" onclick="approveSelectedVersion()">✅ 선택 버전 approved 확정</button>
        <button class="btn btn-restore" onclick="restoreSelectedVersion()">♻️ 선택 버전으로 draft 복원</button>
    </div>

    <h3 style="margin-top:24px;">4. 버전 비교</h3>
    <div class="history-actions">
        <select id="compare-left"></select>
        <span>vs</span>
        <select id="compare-right"></select>
        <button class="btn btn-merge" onclick="compareVersions()">🔍 비교</button>
    </div>
    <pre id="compare-result" class="compare-result">비교할 버전을 선택하세요.</pre>

    <h3 style="margin-top:24px;">5. 저장 결과 Diff 요약</h3>
    <pre id="save-diff-result" class="compare-result">저장 후 추가/삭제/변경 요약이 표시됩니다.</pre>

    <div style="margin-top:20px; text-align:right;">
        <button onclick="clearPreview()" style="border:none; background:none; text-decoration:underline; cursor:pointer; color:#999;">임시 데이터 초기화</button>
    </div>
</div>

<script src="js/admin-controller.js"></script>
</body>
</html>
