<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>JLPT Data Manager</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { padding: 40px; background: #eee; display: block; overflow: auto; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
        .control-panel { background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        textarea { width: 100%; height: 200px; font-family: monospace; padding: 10px; margin-top: 10px; }
        .btn { padding: 10px 20px; color: white; border: none; cursor: pointer; border-radius: 4px; font-weight: bold; margin-right: 10px; }
        .btn-preview { background: #FF9800; }
        .btn-download { background: #4CAF50; }
        .btn-delete { background: #f44336; }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ› ï¸ JLPT ë°ì´í„° ê´€ë¦¬ì (Netlify Fixed)</h1>
    <p>ë°ì´í„° ìƒì„± ì‹œ <code>var</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜¸í™˜ì„±ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.</p>

    <div class="control-panel">
        <label><strong>1. ì‘ì—…í•  ë ˆë²¨ ì„ íƒ:</strong></label>
        <select id="level-select" style="font-size:1.1rem; padding:5px;">
            <option value="n5">N5 (ê¸°ì´ˆ - ë…¸ë‘)</option>
            <option value="n4">N4 (ì´ˆê¸‰ - ì´ˆë¡)</option>
            <option value="n3">N3 (ì¤‘ê¸‰ - íŒŒë‘)</option>
            <option value="n2">N2 (ì¤‘ê³ ê¸‰ - ì£¼í™©)</option>
            <option value="n1">N1 (ê³ ê¸‰ - ë¹¨ê°•)</option>
        </select>
    </div>

    <h3>2. AI JSON ë°ì´í„° ì…ë ¥</h3>
    <textarea id="json-input" placeholder='{"day": 9, "data": { ... }}'></textarea>

    <div style="margin-top:20px;">
        <button class="btn btn-preview" onclick="savePreview(false)">ğŸ’¾ ë®ì–´ì“°ê¸° ì €ì¥</button>
        <button class="btn btn-preview" style="background:#2196F3" onclick="savePreview(true)">ğŸ”— ë³‘í•© ì €ì¥ (Merge)</button>
        <button class="btn btn-download" onclick="downloadFile()">ğŸ“¥ JS íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
    </div>
    
    <div style="margin-top:20px; text-align:right;">
        <button onclick="clearPreview()" style="border:none; background:none; text-decoration:underline; cursor:pointer; color:#999;">ì„ì‹œ ë°ì´í„° ì´ˆê¸°í™”</button>
    </div>
</div>

<script>
    const DEV_KEY = 'JLPT_DEV_DATA_OVERRIDE';

    function savePreview(isMerge) {
        try {
            const level = document.getElementById('level-select').value;
            const input = document.getElementById('json-input').value;
            if (!input.trim()) return alert("JSONì„ ì…ë ¥í•˜ì„¸ìš”");

            const json = JSON.parse(input);
            const day = json.day;
            const key = `${level}-${day}`;
            
            const existing = JSON.parse(localStorage.getItem(DEV_KEY) || '{}');
            
            if (isMerge && existing[key]) {
                existing[key] = { ...existing[key], ...json.data };
                alert(`[${level.toUpperCase()}] Day ${day} ë³‘í•© ì €ì¥ë¨!`);
            } else {
                existing[key] = json.data;
                alert(`[${level.toUpperCase()}] Day ${day} ìƒˆë¡œ ì €ì¥ë¨!`);
            }
            
            localStorage.setItem(DEV_KEY, JSON.stringify(existing));
            
        } catch (e) { alert("JSON ì—ëŸ¬: " + e.message); }
    }

    function downloadFile() {
        const level = document.getElementById('level-select').value;
        const varName = `${level.toUpperCase()}_DATA`;
        
        const existing = JSON.parse(localStorage.getItem(DEV_KEY) || '{}');
        const levelData = {};

        Object.keys(existing).forEach(key => {
            if (key.startsWith(`${level}-`)) {
                const day = key.split('-')[1];
                levelData[day] = existing[key];
            }
        });

        if (Object.keys(levelData).length === 0) {
            if(!confirm("ì €ì¥ëœ í”„ë¦¬ë·° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ í• ê¹Œìš”?")) return;
        }

        // [í•µì‹¬ ìˆ˜ì •] const ëŒ€ì‹  var ì‚¬ìš©
        const fileContent = `/**
 * JLPT ${level.toUpperCase()} Data
 * Updated: ${new Date().toLocaleString()}
 */
var ${varName} = ${JSON.stringify(levelData, null, 4)};
`;

        const blob = new Blob([fileContent], { type: "text/javascript" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `${level}_data.js`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
    
    function clearPreview() {
        if(confirm("ì •ë§ ì‚­ì œí•©ë‹ˆê¹Œ?")) localStorage.removeItem(DEV_KEY);
    }
</script>
</body>
</html>