<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ ë‹¨ì–´ì¥</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="viewer-mode">

    <div id="viewer-content">
        <header class="viewer-header">
            <div class="header-badges">
                <span class="badge-level" style="background:#673AB7;">BOOKMARKS</span>
            </div>
            <h1 id="header-title">â­ ë‚˜ë§Œì˜ ë‹¨ì–´ì¥</h1>
            <p style="color:#666; margin-top:10px;">ë³„í‘œ í‘œì‹œí•œ ë‹¨ì–´ë“¤ì„ ëª¨ì•„ì„œ í•™ìŠµí•˜ì„¸ìš”.</p>
        </header>

        <!-- Filter Tabs -->
        <div class="filter-tabs">
            <button class="filter-btn active" onclick="setFilter('all')">ì „ì²´</button>
            <button class="filter-btn" onclick="setFilter('n5')">N5</button>
            <button class="filter-btn" onclick="setFilter('n4')">N4</button>
            <button class="filter-btn" onclick="setFilter('n3')">N3</button>
            <button class="filter-btn" onclick="setFilter('n2')">N2</button>
            <button class="filter-btn" onclick="setFilter('n1')">N1</button>
        </div>

        <!-- Vocab Section -->
        <section class="study-section">
            <div class="section-header">
                <h2 class="section-title" id="list-title"><i class="fas fa-star"></i> ì €ì¥ëœ ë‹¨ì–´</h2>
                <div class="toolbar">
                    <button id="btn-toggle-mean" class="tool-btn" onclick="toggleMeanings()">ğŸ™ˆ ëœ» ê°€ë¦¬ê¸°</button>
                </div>
            </div>

            <div id="view-list">
                <table id="vocab-table">
                    <thead>
                        <tr>
                            <th width="40">â˜…</th>
                            <th width="60">ê¸‰ìˆ˜</th>
                            <th>ë‹¨ì–´</th>
                            <th>ì½ê¸°</th>
                            <th class="col-mean-header">ì˜ë¯¸</th>
                            <th width="80">ì´ë™</th>
                        </tr>
                    </thead>
                    <tbody id="vocab-tbody">
                        <!-- JS Injected -->
                    </tbody>
                </table>
                <div id="empty-msg" style="display:none; text-align:center; padding:50px; color:#999;">
                    <p>ì €ì¥ëœ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.<br>í•™ìŠµ ë·°ì–´ì—ì„œ ë‹¨ì–´ ì˜†ì˜ ë³„í‘œ(â˜†)ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”!</p>
                </div>
            </div>
        </section>

        <div class="nav-buttons">
            <a href="index.html" target="_parent" class="nav-btn list" style="width:100%; justify-content:center;">
                <i class="fas fa-home"></i> í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </a>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        let currentFilter = 'all';

        function initStarredPage() {
            setFilter('all');
        }

        function setFilter(filter) {
            currentFilter = filter;
            
            // Tab UI Update
            document.querySelectorAll('.filter-btn').forEach(btn => {
                const text = btn.textContent.toLowerCase();
                const isActive = (filter === 'all' && text === 'ì „ì²´') || (text === filter);
                btn.classList.toggle('active', isActive);
            });

            // Theme Color Update
            if(filter !== 'all') document.body.setAttribute('data-theme', filter);
            else document.body.removeAttribute('data-theme');

            refreshStarredList();
        }

        function refreshStarredList() {
            const bookmarks = getBookmarks();
            // ìµœì‹ ìˆœ ì •ë ¬ (addedAt ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
            bookmarks.sort((a, b) => new Date(b.addedAt || 0) - new Date(a.addedAt || 0));

            const tbody = document.getElementById('vocab-tbody');
            const emptyMsg = document.getElementById('empty-msg');
            const table = document.getElementById('vocab-table');

            tbody.innerHTML = '';

            let count = 0;
            bookmarks.forEach(item => {
                if (currentFilter !== 'all' && item.level !== currentFilter) return;

                count++;
                const tr = document.createElement('tr');
                const vJson = JSON.stringify(item).replace(/"/g, '&quot;');
                
                tr.innerHTML = `
                    <td class="col-star">
                        <button class="star-btn active" 
                                onclick="removeAndRefresh('${item.level}', '${item.day}', ${vJson})">
                            â˜…
                        </button>
                    </td>
                    <td style="text-align:center;"><span class="badge-level" style="font-size:0.7rem; padding:2px 6px;">${item.level.toUpperCase()}</span></td>
                    <td class="col-word" onclick="speak('${item.word}')">ğŸ”Š ${item.word}</td>
                    <td class="col-read">${item.read}</td>
                    <td class="col-mean"><span>${item.mean}</span></td>
                    <td style="text-align:center;">
                        <a href="viewer.html?level=${item.level}&day=${item.day}" class="tool-btn" style="text-decoration:none; font-size:0.8rem;">Day ${item.day}</a>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            if (count === 0) {
                table.style.display = 'none';
                emptyMsg.style.display = 'block';
            } else {
                table.style.display = 'table';
                emptyMsg.style.display = 'none';
            }
        }

        function removeAndRefresh(level, day, item) {
            // toggleStar í•¨ìˆ˜ëŠ” ì´ë¯¸ ìˆìœ¼ë©´ ì‚­ì œí•¨
            toggleStar(level, day, item, null);
            // ë¦¬ìŠ¤íŠ¸ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            refreshStarredList();
        }

        // ê¸€ë¡œë²Œ í•¨ìˆ˜ ë“±ë¡ (common.jsì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡)
        window.refreshStarredList = refreshStarredList;

        document.addEventListener('DOMContentLoaded', initStarredPage);
    </script>
</body>
</html>