<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLPT All-in-One 단어장</title>
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>JLPT All-in-One</h1>
            <div class="level-selector">
                <button onclick="loadLevel('n5')">N5</button>
                <button onclick="loadLevel('n4')">N4</button>
                <button onclick="loadLevel('n3')">N3</button>
                <button onclick="loadLevel('n2')">N2</button>
                <button onclick="loadLevel('n1')">N1</button>
            </div>
        </header>

        <main>
            <div id="loading" style="display:none;">데이터를 불러오는 중...</div>
            <ul id="vocab-list" class="vocab-list">
                <!-- 단어 리스트가 여기에 생성됩니다 -->
            </ul>
        </main>

        <footer>
            <p>JLPT 학습 도우미 <a href="viewer.html">구문 분석 뷰어 이동</a></p>
        </footer>
    </div>

    <!-- common.js 먼저 로드 (TTS 함수 포함) -->
    <script src="common.js"></script>
    <script>
        // 초기 로드 시 N5 데이터 로드 (예시)
        document.addEventListener('DOMContentLoaded', () => {
            loadLevel('n5');
        });

        async function loadLevel(level) {
            const listContainer = document.getElementById('vocab-list');
            const loading = document.getElementById('loading');
            
            listContainer.innerHTML = '';
            loading.style.display = 'block';

            try {
                // JSON 파일 경로 (data 폴더 구조 가정)
                const response = await fetch(`data/jlpt_${level}_vocab.json`);
                const data = await response.json();

                loading.style.display = 'none';

                data.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'vocab-item';

                    // 단어 정보 구성
                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'vocab-info';
                    
                    const wordSpan = document.createElement('span');
                    wordSpan.className = 'word';
                    wordSpan.textContent = item.word || item.kanji; // 데이터 키값에 따라 조정

                    const readingSpan = document.createElement('span');
                    readingSpan.className = 'reading';
                    readingSpan.textContent = item.reading || item.kana;

                    const meaningSpan = document.createElement('span');
                    meaningSpan.className = 'meaning';
                    meaningSpan.textContent = item.meaning || item.kor;

                    infoDiv.appendChild(wordSpan);
                    infoDiv.appendChild(readingSpan);
                    infoDiv.appendChild(meaningSpan);

                    // --- [TTS 버튼 추가] ---
                    // common.js에 있는 createTTSButton 함수 사용
                    // 요미가나(reading)를 우선으로 읽되, 없으면 단어(word)를 읽음
                    const ttsText = item.reading || item.word;
                    const ttsBtn = createTTSButton(ttsText);
                    
                    li.appendChild(infoDiv);
                    li.appendChild(ttsBtn); // 리스트 아이템 오른쪽에 버튼 추가
                    
                    listContainer.appendChild(li);
                });

            } catch (error) {
                console.error('Error loading vocabulary:', error);
                loading.textContent = '데이터를 불러오는데 실패했습니다.';
            }
        }
    </script>
</body>
</html>
